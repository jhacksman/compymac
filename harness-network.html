<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harness Operator Pipeline</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; background: #1a1a2e; color: #eee; min-height: 100vh; padding: 20px; }
        h1 { text-align: center; margin-bottom: 10px; color: #00d4ff; }
        .subtitle { text-align: center; color: #888; margin-bottom: 30px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .section { background: #16213e; border-radius: 12px; padding: 20px; margin-bottom: 30px; }
        .section h2 { color: #00d4ff; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .mermaid { background: #0f0f23; border-radius: 8px; padding: 20px; overflow-x: auto; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: #0f0f23; border-radius: 8px; padding: 15px; border-left: 4px solid #00d4ff; }
        .card h3 { color: #00d4ff; margin-bottom: 10px; font-size: 14px; }
        .card ul { list-style: none; font-size: 12px; }
        .card li { padding: 3px 0; border-bottom: 1px solid #222; }
        .card li:last-child { border-bottom: none; }
        .tool-name { color: #f39c12; font-weight: bold; }
        .param { color: #2ecc71; }
        .optional { color: #888; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
        th, td { padding: 8px; text-align: left; border-bottom: 1px solid #333; }
        th { color: #00d4ff; }
        .measured { color: #2ecc71; }
        .unknown { color: #e74c3c; }
        .partial { color: #f39c12; }
        a { color: #00d4ff; }
        .legend { display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap; }
        .legend span { display: flex; align-items: center; gap: 8px; }
        .dot { width: 12px; height: 12px; border-radius: 50%; }
        .dot.g { background: #2ecc71; }
        .dot.y { background: #f39c12; }
        .dot.r { background: #e74c3c; }
        .tool-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 15px; }
        .tool-card { background: #0f0f23; border-radius: 8px; padding: 12px; }
        .tool-card h4 { color: #f39c12; margin-bottom: 8px; font-size: 13px; }
        .tool-card .params { font-size: 11px; color: #aaa; }
        .tool-card .req { color: #2ecc71; }
        .tool-card .opt { color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Harness Operator Pipeline</h1>
        <p class="subtitle">Granular tool inventory with parameters, outputs, and constraints</p>
        
        <div class="section">
            <h2>1. Operator Pipeline</h2>
            <div class="mermaid">
flowchart TB
    U[User Input] --> CA1[Context Assembly]
    CA1 --> PP[Primary Processing]
    PP --> TR[Tool Router]
    TR --> FILE[File Ops]
    TR --> SHELL[Shell]
    TR --> BROWSER[Browser]
    TR --> GIT[Git]
    TR --> SEARCH[Search]
    TR --> LSP[LSP]
    TR --> MCP[MCP]
    TR --> DEPLOY[Deploy]
    TR --> REC[Recording]
    TR --> VAR[Variable Output]
    TR --> UTIL[Utility]
    FILE --> RF[Result Formatter]
    SHELL --> RF
    BROWSER --> RF
    GIT --> RF
    SEARCH --> RF
    LSP --> RF
    MCP --> RF
    DEPLOY --> RF
    REC --> RF
    VAR --> RF
    UTIL --> RF
    RF --> TN[Truncation]
    TN --> CA2[Context Assembly]
    CA2 --> PP
    PP --> U
            </div>
        </div>

        <div class="section">
            <h2>2. Complete Tool Inventory</h2>
            
            <h3 style="color: #f39c12; margin: 20px 0 10px;">File Operations</h3>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>Read</h4>
                    <div class="params"><span class="req">file_path</span> | <span class="opt">offset, limit</span></div>
                    <div class="params">Output: &lt;full-file-view&gt; with line numbers</div>
                </div>
                <div class="tool-card">
                    <h4>Edit</h4>
                    <div class="params"><span class="req">file_path, old_string, new_string</span> | <span class="opt">replace_all</span></div>
                    <div class="params">Constraint: Must Read first; old_string unique</div>
                </div>
                <div class="tool-card">
                    <h4>Write</h4>
                    <div class="params"><span class="req">file_path, content</span></div>
                    <div class="params">Constraint: Must Read existing files first</div>
                </div>
            </div>

            <h3 style="color: #f39c12; margin: 20px 0 10px;">Shell Operations</h3>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>bash</h4>
                    <div class="params"><span class="req">command, exec_dir, bash_id</span> | <span class="opt">timeout, description, run_in_background</span></div>
                    <div class="params">Output: &lt;shell-output&gt; with return code | Truncation: ~30k chars</div>
                </div>
                <div class="tool-card">
                    <h4>bash_output</h4>
                    <div class="params"><span class="req">bash_id</span> | <span class="opt">filter (regex)</span></div>
                </div>
                <div class="tool-card">
                    <h4>write_to_shell</h4>
                    <div class="params"><span class="req">shell_id</span> | <span class="opt">content, press_enter</span></div>
                </div>
                <div class="tool-card">
                    <h4>kill_shell</h4>
                    <div class="params"><span class="req">shell_id</span></div>
                </div>
            </div>

            <h3 style="color: #f39c12; margin: 20px 0 10px;">Browser Operations</h3>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>browser_navigate</h4>
                    <div class="params"><span class="req">url</span> | <span class="opt">tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_view</h4>
                    <div class="params"><span class="opt">tab_idx, reload_window</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_click</h4>
                    <div class="params"><span class="opt">devinid, coordinates, tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_type</h4>
                    <div class="params"><span class="req">content</span> | <span class="opt">devinid, coordinates, press_enter, tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_press_key</h4>
                    <div class="params"><span class="req">content</span> | <span class="opt">tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_scroll</h4>
                    <div class="params"><span class="req">direction, devinid</span> | <span class="opt">tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_console</h4>
                    <div class="params"><span class="opt">content (JS), tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_move_mouse</h4>
                    <div class="params"><span class="opt">devinid, coordinates, tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_select_option</h4>
                    <div class="params"><span class="req">index</span> | <span class="opt">devinid, tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_select_file</h4>
                    <div class="params"><span class="req">content (paths)</span> | <span class="opt">tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_set_mobile</h4>
                    <div class="params"><span class="req">enabled</span> | <span class="opt">tab_idx</span></div>
                </div>
                <div class="tool-card">
                    <h4>browser_restart</h4>
                    <div class="params"><span class="req">url</span> | <span class="opt">extensions</span></div>
                </div>
            </div>

            <h3 style="color: #f39c12; margin: 20px 0 10px;">Git Operations</h3>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>git_view_pr</h4>
                    <div class="params"><span class="req">repo, pull_number</span></div>
                </div>
                <div class="tool-card">
                    <h4>git_create_pr</h4>
                    <div class="params"><span class="req">repo, title, head_branch, base_branch, exec_dir</span> | <span class="opt">draft</span></div>
                </div>
                <div class="tool-card">
                    <h4>git_update_pr_description</h4>
                    <div class="params"><span class="req">repo, pull_number</span> | <span class="opt">force</span></div>
                </div>
                <div class="tool-card">
                    <h4>git_pr_checks</h4>
                    <div class="params"><span class="req">repo, pull_number</span> | <span class="opt">wait_until_complete</span></div>
                </div>
                <div class="tool-card">
                    <h4>git_ci_job_logs</h4>
                    <div class="params"><span class="req">repo, job_id</span></div>
                </div>
                <div class="tool-card">
                    <h4>git_comment_on_pr</h4>
                    <div class="params"><span class="req">repo, pull_number, body</span> | <span class="opt">commit_id, path, line, side, in_reply_to</span></div>
                </div>
                <div class="tool-card">
                    <h4>list_repos</h4>
                    <div class="params"><span class="opt">keyword, page</span></div>
                </div>
            </div>

            <h3 style="color: #f39c12; margin: 20px 0 10px;">Search Operations</h3>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>grep</h4>
                    <div class="params"><span class="req">pattern, path</span> | <span class="opt">output_mode, glob, type, -A/-B/-C, -i, -n, multiline, head_limit</span></div>
                </div>
                <div class="tool-card">
                    <h4>glob</h4>
                    <div class="params"><span class="req">pattern, path</span></div>
                </div>
                <div class="tool-card">
                    <h4>web_search</h4>
                    <div class="params"><span class="req">query</span> | <span class="opt">num_results, type, include_domains, exclude_domains, start_published_date</span></div>
                </div>
                <div class="tool-card">
                    <h4>web_get_contents</h4>
                    <div class="params"><span class="req">urls (max 10)</span></div>
                </div>
            </div>

            <h3 style="color: #f39c12; margin: 20px 0 10px;">Code Intelligence / Integration / Deploy</h3>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>lsp_tool</h4>
                    <div class="params"><span class="req">command, path</span> | <span class="opt">line, symbol</span></div>
                    <div class="params">Commands: goto_definition, goto_references, hover_symbol, file_diagnostics</div>
                </div>
                <div class="tool-card">
                    <h4>mcp_tool</h4>
                    <div class="params"><span class="req">command</span> | <span class="opt">server, tool_name, tool_args, resource_uri, shell_id</span></div>
                    <div class="params">Commands: list_servers, list_tools, call_tool, read_resource</div>
                </div>
                <div class="tool-card">
                    <h4>deploy</h4>
                    <div class="params"><span class="req">command</span> | <span class="opt">dir, port</span></div>
                    <div class="params">Commands: frontend, backend, logs, expose</div>
                </div>
            </div>

            <h3 style="color: #f39c12; margin: 20px 0 10px;">Recording / Variable Output / Utility</h3>
            <div class="tool-grid">
                <div class="tool-card">
                    <h4>recording_start / recording_stop</h4>
                    <div class="params">No params | Output: video path</div>
                </div>
                <div class="tool-card">
                    <h4>ask_smart_friend</h4>
                    <div class="params"><span class="req">question</span></div>
                    <div class="params">Output: Suggestions / Answer / Be Careful / MISSING INFO</div>
                </div>
                <div class="tool-card">
                    <h4>visual_checker</h4>
                    <div class="params"><span class="req">question</span></div>
                    <div class="params">Output: Avoiding Bias / Visual Analysis / Answer / MISSING INFO</div>
                </div>
                <div class="tool-card">
                    <h4>message_user</h4>
                    <div class="params"><span class="req">message, block_on_user, should_use_concise_message</span> | <span class="opt">attachments, request_auth, request_deploy</span></div>
                </div>
                <div class="tool-card">
                    <h4>wait</h4>
                    <div class="params"><span class="req">seconds (max 600)</span></div>
                </div>
                <div class="tool-card">
                    <h4>TodoWrite</h4>
                    <div class="params"><span class="req">todos (array of {content, status})</span></div>
                </div>
                <div class="tool-card">
                    <h4>think</h4>
                    <div class="params"><span class="req">thought</span></div>
                </div>
                <div class="tool-card">
                    <h4>list_secrets</h4>
                    <div class="params">No params | Output: secret names only</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>3. Experiment Backlog</h2>
            <div class="grid">
                <div class="card">
                    <h3>Truncation Threshold</h3>
                    <ul>
                        <li>print('x' * N) for N in [29k-31k]</li>
                        <li>Find exact cutoff</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Schema Validation</h3>
                    <ul>
                        <li>Omit required args</li>
                        <li>Wrong types</li>
                        <li>Unknown fields</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Result Isolation</h3>
                    <ul>
                        <li>File with instruction text</li>
                        <li>Observe envelope</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Redaction Test</h3>
                    <ul>
                        <li>Fake secret in file</li>
                        <li>Check if masked</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Concurrency Limits</h3>
                    <ul>
                        <li>10 parallel sleep 2</li>
                        <li>Measure wall time</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Max Input Size</h3>
                    <ul>
                        <li>Increase Write content</li>
                        <li>Find per-tool limits</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Error Envelopes</h3>
                    <ul>
                        <li>Trigger errors across tools</li>
                        <li>Compare structure</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>DOM Stability</h3>
                    <ul>
                        <li>5x browser_view same page</li>
                        <li>Diff outputs</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Context Scope</h3>
                    <ul>
                        <li>Establish fact early</li>
                        <li>Ask smart friend later</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Latency Profiling</h3>
                    <ul>
                        <li>10x each operator</li>
                        <li>Compute mean/variance</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Caching Test</h3>
                    <ul>
                        <li>Identical queries back-to-back</li>
                        <li>Compare results</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>Parallel Verification</h3>
                    <ul>
                        <li>5 parallel sleep 2</li>
                        <li>~2s = concurrent</li>
                    </ul>
                </div>
            </div>
        </div>

        <p style="text-align: center; margin-top: 30px; color: #666;">
            <a href="./harness.md">View detailed lab notebook</a>
        </p>
    </div>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'dark', securityLevel: 'loose' });</script>
</body>
</html>